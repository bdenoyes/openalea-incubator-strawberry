---
title: "Architecture_analysis"
author: "Marc LABADIE"
date: "5 juin 2018"
output:
  html_document:
    df_print: kable
    fig_caption: yes
    keep_md: yes
    number_sections: yes
    toc: yes
    toc_depth: 4
  word_document:
    toc: yes
    toc_depth: 4
    fig_caption: yes
    df_print: kable
  pdf_document:
    fig_caption: yes
    fig_crop: no
    keep_tex: yes
    number_sections: yes
    toc: yes
    toc_depth: 4
geometry: margin= 2cm
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,warning = FALSE, message = FALSE, dpi = 800,fig.pos = "h")
```

\listoffigures
\listoftables

#Requierements

##Packages install 

```{r Package install ,eval=FALSE}
install.packages("plyr")
install.packages("ggplot2")
install.packages("gtable")
install.packages("grid")
install.packages("cowplot")
install.packages("reshape2")
install.packages("scales")
install.packages("knitr")
install.packages("tinytex")
install.packages("dplyr")
install.packages("lmtest")
install.packages("agricolae")
install.packages("PMCMR")
#install.packages("RCurl")
```

##Packages loading
```{r Package loading, eval=TRUE, echo=TRUE, message=FALSE, warning=FALSE}
library(plyr)
library(ggplot2)
library(gtable)
library(grid)
library(cowplot)
library(reshape2)
library(scales)
library(knitr)
library(tinytex)
library(dplyr)
#library(RCurl)
library(rmarkdown)
library(lmtest)
library(agricolae)
library(PMCMR)
library(gtools)
```

## Functions importing
```{r}
source(file = "c:/Users/mlabadie/Documents/GitHub/strawberry/Rscript/Functions.R")
```

#Import and transformation of dataset 

##Import dataset

**INDEX_PARAMETER :** TIME   # vertex_id

**15 VARIABLES:**

- VARIABLE 1 : INT  # nb_visible_leaves. No. elongated leaves (F)
- VARIABLE 2 : INT  # nb_foliar_primordia No. primordia (f)
- VARIABLE 3 : INT  # nb_total_leaves. Total no. leaves (F+f)
- VARIABLE 4 : INT  # nb_open_flowers. No. open flowers
- VARIABLE 5 : INT  # nb_aborted_flowers No. aborted flowers
- VARIABLE 6 : INT  # nb_total_flowers Total no. flowers 
- VARIABLE 7 : INT  # vegetative_bud. No. vegetative buds (axillary vegetative bud)
- VARIABLE 8 : INT  # Initiated_bud. No. initiated bud (axillary initiated bud)
- VARIABLE 9 : INT  # floral_bud. No. floral buds (axillary floral bud)
- VARIABLE 10 : INT  # stolons No. stolons
- VARIABLE 11 : INT  # type_of_crown. Type of crown (1: primary crown, 2: extention crowns, 3: branch crown)
- VARIABLE 12 : INT  # Crown_status (1: Terminal Vegetative bud (bt, stage 17, 18, 19, None), 2:Terminal bud initiated (bt, stage A), 3: Terminal floral bud(ht), 4: Inflorescence(HT), -1: rotten or aborded)
- VARIABLE 13 : INT  # genotype (1: Gariguette, 2: Ciflorette, 3: Clery, 4: Capriss, 5:Darselect, 6: Cir107)
- VARIABLE 14 : INT  # date (1: mid December, 2: early Junuary, 3: mid February, 4: early March, 5: early April, 6: end May/early June)
- VARIABLE 15 : INT  # plant. plant index

```{r Import dataset}
DataSet <- read.csv(
  "c:/Users/mlabadie/Documents/GitHub/strawberry/Rscript/Dataset.csv", 
  sep=";",na.strings = "-1")

colstart<-1
colend<-dim(DataSet)[2]-2

data<-DataSet[,c(colstart:colend)]
```

## Dataset Class Object

```{r Dataset Class Object}
str(object = data)
```

## Transformation of Class object
```{r Transformation of Class object}
data$genotype<- as.factor(data$genotype)
data$date<- as.factor(DataSet$date)
data$Crown_status<- as.factor(DataSet$Crown_status)
data$type_of_crown<- as.factor(DataSet$type_of_crown)
```

## Conversion of dataset
```{r Conversion of dataset}

# Convert numerical categorical ordered value in factor values with their properties 

data$genotype<- factor(x = data$genotype,
                       levels = levels(x = data$genotype),
                       labels = c("Gariguette","Ciflorette","Clery","Capriss","Darselect","Cir107")
                       )

data$date<- factor(x = data$date,
                   levels = levels(x = data$date),
                   labels = c("Mid-December","Early-Junuary","Mid-February","Early-March","Early-April","Early-June")
                   )

data$type_of_crown<- factor(x = DataSet$type_of_crown,
                            levels = levels(x = data$type_of_crown),
                            labels = c("Primary_Crown","Extention_Crown","Branch_Crown")
                            )
data$Crown_status<- factor(x = data$Crown_status,
                              levels = levels(x = data$Crown_status),
                              labels = c("Terminal_Vegetative_bud","Terminal_initiated_bud","Terminal_Floral_bud","Terminal_Inflorescence"))

```

```{r convert Index data}
#convert index sequence analysis in index for R analysis
dat<-data[2:colend]
for (i in 1:nrow(data)){ 
  if (data[i,'Index']=="0"){ 
    dat[i,"Index"]<- 0
  }else if (data[i,'Index']=="0-1"){
    dat[i,"Index"]<- 1
  }else if (data[i,'Index']=="0-1-2"){
    dat[i,"Index"]<- 2
  }else if (data[i,'Index']=="0-1-2-3"){
    dat[i,"Index"]<- 3
  }else if (data[i,'Index']=="0-1-2-3-4"){
    dat[i,"Index"]<- 4
  }else if (data[i,'Index']=="0-1-2-3-4-5"){
    dat[i,"Index"]<- 5
  }else if (data[i,'Index']=="1"){
    dat[i,"Index"]<- 1
  }else if (data[i,'Index']=="1-2"){
    dat[i,"Index"]<- 2
  }else if (data[i,'Index']=="1-2-3"){
    dat[i,"Index"]<- 3
  }else if (data[i,'Index']=="1-2-3-4"){
    dat[i,"Index"]<- 4
  }else if (data[i,'Index']=="1-2-3-4-5"){
    dat[i,"Index"]<- 5
  }else if (data[i,'Index']=="2"){
    dat[i,"Index"]<- 2
  }else if (data[i,'Index']=="2-3"){
    dat[i,"Index"]<- 3
  }else if (data[i,'Index']=="2-3-4"){
    dat[i,"Index"]<- 4
  }else if (data[i,'Index']=="3"){
    dat[i,"Index"]<- 3
  }else if (data[i,'Index']=="3-4"){
    dat[i,"Index"]<- 4
  }else if (data[i,'Index']=="4"){
    dat[i,"Index"]<- 4
  }
}

dat$Index<-as.factor(x = dat$Index)

#Remplacer les valeurs 0 dans la colone total flowers par NA
dat$nb_total_flowers[dat$nb_total_flowers==0]<-NA

#kable(x = dat,digits = 2,caption = "Data extract from MTG")
```


# Exploratory analysis

## At plant scale


## At module scale

### Extraction of data at module scale 

```{r Extraction of data at module scale}
data_at_module_scale<-ddply(.data = dat,
                            .variables = c("genotype","Index"),
                            summarise,
                            MeanTotalLeave= mean(x = nb_total_leaves,
                                                 na.rm = T),
                            SdTotalLeave= sd(x = nb_total_leaves,
                                             na.rm = T),
                            MeanTotalFlower= mean(x = nb_total_flowers,
                                                  na.rm = T),
                            SdTotalFlower= sd(x = nb_total_flowers,
                                              na.rm = T),
                            MeanStolon= mean(x = stolons,
                                             na.rm = T),
                            SdStolon= sd(x = stolons,
                                         na.rm = T),
                            N=length(nb_total_leaves))

kable(x = data_at_module_scale,caption = " Data at module scale",digits = 2)
```

### Number of Module for successive orders

```{r Number of Module for successive orders}
tab1<- fc_dist_module_by_order(data = dat,index = "Index")

kable(x = tab1,
      caption = "No. Module by varieties for successive orders "
      )
```

### Occurence of the higher order along time

* **Table of distribution of higher order along time**

```{r Occurence of the higher order along time}
tab2<- fc_dist_order_by_date(data = dat,
                             genotype = "Gariguette",
                             prob = "cumulative")
kable(x = tab2, 
      caption = "Module order frequency distribution for successive date",digits = 2)
```

* **Plot visualization of distribution of higher order along time**

```{r Plot Module order frequency distribution for successive date, fig.cap="Module order frequency distribution for successive date"}
fc_dist_order_by_date.plot(data=tab2)+
  geom_hline(yintercept = 0.9,linetype="dashed")
```

### Cumulative distribution of one varname for each module order

* **Total No. leaves**



* ** Total No. flowers**

  - *Table of distribution of total no. flowers according to module orders* 
  
```{r Table Cumulative distribution of no. flowers for each module order}
tab4<-fc_dist_variable_by_order(data = dat,genotype = "Gariguette",varname = "nb_total_flowers",prob = "cumulative")

kable(x = tab4, 
      caption = "Cumulative distribution of total no. flowers by orders",digits = 2)

```

  -  *Visualization of distribution of total no. flowers for each module orders*

```{r Plot distribution of one variable for each module orders, fig.cap= "Plot distribution of flowers for each module orders"}
fc_dist_variable_by_order.plot(data = tab4,genotype= "Gariguette")+
  xlab("No. flowers")+
  ylab("Cumulative distribution function")
```

* ** Total No. stolons**

  - *Table of distribution of total no. flowers according to module orders* 
  
```{r Table Cumulative distribution of no. stolons for each module order}
tab5<-fc_dist_variable_by_order(data = dat,genotype = "Gariguette",varname = "stolons",prob = "cumulative")

kable(x = tab5, 
      caption = "Cumulative distribution of total no. stolons by orders",
      digits = 2)

```

  -  *Visualization of distribution of total no. flowers for each module orders*

```{r Plot distribution of one variable for each module orders, fig.cap= "Plot distribution of no. stolons for each module orders"}
fc_dist_variable_by_order.plot(data = tab5)+
  xlab("No. Leaves")+
  ylab("Cumulative distribution function")
```


### Analysis of quantitative variable function of successive orders

In the following architectural analyses, we chose to group the highest-order modules because of the small sample size (cf. tables 1: No. Module by varieties for successive orders).

For this, we used a recursive pooling of samples from the highest order downward if sample size =< 8


* **Build data according group**

```{r Group highiest modules orders}
dat_group<-data[2:colend]

for (i in 1:nrow(data)){
  if( dat_group[i,"genotype"]=="Capriss"){
    if (data[i,'Index']=="0"){ 
      dat_group[i,"Index"]<- 0
      }else if (data[i,'Index']=="0-1"){
      dat_group[i,"Index"]<- 1
      }else if (data[i,'Index']=="0-1-2"){
        dat_group[i,"Index"]<- 2
      }else if (data[i,'Index']=="0-1-2-3"){
        dat_group[i,"Index"]<- 3
      }else if (data[i,'Index']=="0-1-2-3-4"){
        dat_group[i,"Index"]<- 3
      }else if (data[i,'Index']=="0-1-2-3-4-5"){
        dat_group[i,"Index"]<- 3
      }else if (data[i,'Index']=="1"){
        dat_group[i,"Index"]<- 1
      }else if (data[i,'Index']=="1-2"){
        dat_group[i,"Index"]<- 2
      }else if (data[i,'Index']=="1-2-3"){
        dat_group[i,"Index"]<- 3
      }else if (data[i,'Index']=="1-2-3-4"){
        dat_group[i,"Index"]<- 3
      }else if (data[i,'Index']=="1-2-3-4-5"){
        dat_group[i,"Index"]<- 3
      }else if (data[i,'Index']=="2"){
        dat_group[i,"Index"]<- 2
      }else if (data[i,'Index']=="2-3"){
        dat_group[i,"Index"]<- 3
      }else if (data[i,'Index']=="2-3-4"){
        dat_group[i,"Index"]<- 3
      }else if (data[i,'Index']=="3"){
        dat_group[i,"Index"]<- 3
      }else if (data[i,'Index']=="3-4"){
        dat_group[i,"Index"]<- 3
      }else if (data[i,'Index']=="4"){
        dat_group[i,"Index"]<- 3
      }
    }else
  if (data[i,'Index']=="0"){ 
    dat_group[i,"Index"]<- 0
  }else if (data[i,'Index']=="0-1"){
    dat_group[i,"Index"]<- 1
  }else if (data[i,'Index']=="0-1-2"){
    dat_group[i,"Index"]<- 2
  }else if (data[i,'Index']=="0-1-2-3"){
    dat_group[i,"Index"]<- 3
  }else if (data[i,'Index']=="0-1-2-3-4"){
    dat_group[i,"Index"]<- 4
  }else if (data[i,'Index']=="0-1-2-3-4-5"){
    dat_group[i,"Index"]<- 4
  }else if (data[i,'Index']=="1"){
    dat_group[i,"Index"]<- 1
  }else if (data[i,'Index']=="1-2"){
    dat_group[i,"Index"]<- 2
  }else if (data[i,'Index']=="1-2-3"){
    dat_group[i,"Index"]<- 3
  }else if (data[i,'Index']=="1-2-3-4"){
    dat_group[i,"Index"]<- 4
  }else if (data[i,'Index']=="1-2-3-4-5"){
    dat_group[i,"Index"]<- 4
  }else if (data[i,'Index']=="2"){
    dat_group[i,"Index"]<- 2
  }else if (data[i,'Index']=="2-3"){
    dat_group[i,"Index"]<- 3
  }else if (data[i,'Index']=="2-3-4"){
    dat_group[i,"Index"]<- 4
  }else if (data[i,'Index']=="3"){
    dat_group[i,"Index"]<- 3
  }else if (data[i,'Index']=="3-4"){
    dat_group[i,"Index"]<- 4
  }else if (data[i,'Index']=="4"){
    dat_group[i,"Index"]<- 4
  }
}

#Remplacer les valeurs 0 dans la colone total flowers par NA
dat_group$nb_total_flowers[dat_group$nb_total_flowers==0]<-NA

dat_group$Index<-as.factor(dat_group$Index)

```

* **check that the modules have been well grouped**

```{r check that the modules have been well grouped}
tab6<- fc_dist_module_by_order(data = dat_group,index = "Index")
kable(x = tab6,caption = "Number of modules for each successive orders after grouping for each varieties")
```

[**Hint:** Compare tab4 with tab1]

#### Data at module scale after grouping

```{r Recalculate data_at_module_scale after grouping}

data_at_module_scale_group<-ddply(.data = dat_group,
                                  .variables = c("genotype","Index"),
                                  summarise,
                                  MeanTotalLeave= mean(x = nb_total_leaves,
                                                       na.rm = T),
                                  SdTotalLeave= sd(x = nb_total_leaves,
                                                   na.rm = T),
                                  MeanTotalFlower= mean(x = nb_total_flowers,
                                                        na.rm = T),
                                  SdTotalFlower= sd(x = nb_total_flowers,
                                                    na.rm = T),
                                  MeanStolon= mean(x = stolons,
                                                   na.rm = T),
                                  SdStolon= sd(x = stolons,
                                               na.rm = T),
                            N=length(nb_total_leaves))

kable(x = data_at_module_scale_group,caption = " Data at module scale after grouping",digits = 2)
```

#### No. leaves fonction of successive module order

##### Cumulative distribution of no. leaves for each module orders

  - *Table of distribution of one varname according to module orders* 
```{r Table Cumulative distribution of no. leaves for each module order}
tab3<-fc_dist_variable_by_order(data = dat,genotype = "Gariguette",varname = "nb_total_leaves",prob = "cumulative")

kable(x = tab3, 
      caption = "Cumulative distribution of total no. leaves by orders for Gariguette",digits = 2)

```

  -  *Visualization of distribution of varname for each module orders*

```{r Plot distribution of one variable for each module orders, fig.cap= "Plot distribution of leaves for each module orders and for Gariguette"}
fc_dist_variable_by_order.plot(data = tab3)+
  xlab("No. Leaves")+
  ylab("Cumulative distribution function")
```

##### Pointwise Mean of No.leaves of modules for successive orders for each varieties

```{r Pointwise Mean of variable of modules for successive orders for each variety after grouping, fig.cap="Pointwise Mean of No. leaves of modules for successive orders for each variety after grouping"}
fc_pointwise_mean_variable_by_order(data = data_at_module_scale_group,varname = "MeanTotalLeave")+
  ylab("Mean No. Leaves")+
  ylim(2,10)
```

##### Comparison of variable for successive orders

Because pointwise of the mean no.leaves and mean no.flowers seems roughly constant for each varieties. In order to compare varieties we used trend linear regression, in particular we test the zero value of the slope parameter. 

* **Identification from wich module variable was roughly constant for each varieties**

  - *From Order 0*
```{r linear trend (estimate slope and IC95%) from Order 0}
Gariguette<- fc_linear_trend_reg(data = dat_group,
                                 genotype = "Gariguette",
                                 variable = "nb_total_leaves",
                                 Index = "Index")

Clery<- fc_linear_trend_reg(data = dat_group,
                            genotype = "Gariguette",
                            variable = "nb_total_leaves",
                            Index = "Index")

Capriss<- fc_linear_trend_reg(data = dat_group,
                              genotype = "Capriss",
                              variable = "nb_total_leaves",
                              Index = "Index")

Ciflorette<- fc_linear_trend_reg(data = dat_group,
                                 genotype = "Ciflorette",
                                 variable = "nb_total_leaves",
                                 Index = "Index")

Cir107<- fc_linear_trend_reg(data = dat_group,
                             genotype = "Cir107",
                             variable = "nb_total_leaves",
                             Index = "Index")

Darselect<- fc_linear_trend_reg(data = dat_group,
                                genotype = "Darselect",
                                variable = "nb_total_leaves",
                                Index = "Index")

tab5<- merge(x = Gariguette,y = Clery,all=T)
tab5<- merge(x = tab5,y = Capriss, all=T)
tab5<- merge(x = tab5,y = Ciflorette, all=T)
tab5<- merge(x = tab5,y = Cir107, all=T)
tab5<- merge(x = tab5,y = Darselect, all=T)

kable(x = tab5,digits = 2,caption = "Linear trend (estimate slope and 95% confidence interval -IC95%-)")
```

**Result:** The no. leaves was roughly constant from first-order module

  - *From Order 1*
  
```{r linear trend (estimate slope and IC95%) from Order 1}
dat_group_from_Order1<-dat_group[!dat_group[,'Index']=="0",]

Gariguette<- fc_linear_trend_reg(data = dat_group_from_Order1,
                                 genotype = "Gariguette",
                                 variable = "nb_total_flowers",
                                 Index = "Index")

Clery<- fc_linear_trend_reg(data = dat_group_from_Order1,
                            genotype = "Gariguette",
                            variable = "nb_total_flowers",
                            Index = "Index")

Capriss<- fc_linear_trend_reg(data = dat_group_from_Order1,
                              genotype = "Capriss",
                              variable = "nb_total_flowers",
                              Index = "Index")

Ciflorette<- fc_linear_trend_reg(data = dat_group_from_Order1,
                                 genotype = "Ciflorette",
                                 variable = "nb_total_flowers",
                                 Index = "Index")

Cir107<- fc_linear_trend_reg(data = dat_group_from_Order1,
                             genotype = "Cir107",
                             variable = "nb_total_flowers",
                             Index = "Index")

Darselect<- fc_linear_trend_reg(data = dat_group_from_Order1,
                                genotype = "Darselect",
                                variable = "nb_total_flowers",
                                Index = "Index")

tab6<- merge(x = Gariguette,y = Clery,all=T)
tab6<- merge(x = tab6,y = Capriss, all=T)
tab6<- merge(x = tab6,y = Ciflorette, all=T)
tab6<- merge(x = tab6,y = Cir107, all=T)
tab6<- merge(x = tab6,y = Darselect, all=T)

kable(x = tab6,digits = 2,caption = "Linear trend (estimate slope and 95% confidence interval -IC95%-)")
```

* ** Comparison between variety for zeroth-order module and first-order modules**


  - *From Order 0*
  
```{r Comparison of Mean No.Leaves for Order 0 between varieties}

dat_group_Order0<- dat_group[dat_group[,"Index"]=="0",]

tab8<-fc_comp_varieties_kruskal_posthoc(data = dat_group_Order0,varname = "nb_total_leaves",groupe = T)


kable(x = tab8,digits = 2,caption = "Mean number with standard deviation and grouping of varieties using ANOVA on rank (Kruskal Wallis and posthoc test) represented by letter for zeroth-order module")

```

  - *From Order 1*

```{r Comparison of Mean No.Leaves from Order 1 onward between varieties}

tab9<-fc_comp_varieties_kruskal_posthoc(data = dat_group_from_Order1,varname = "nb_total_leaves",group = T)


kable(x = tab9,digits = 2,caption = "Mean number with standard deviation and grouping of varieties using ANOVA on rank (Kruskal Wallis and posthoc test) represented by letter from the first-order modules onward")
```  
  - *Pointwise Mean No. leaves of succesive orders module (0 and >=1)*
  
```{r TODO}

```

#### No. flowers fonction of successive module order

##### Cumulative 
* **Identification from wich module variable was roughly constant for each varieties**

  - *From Order 0*
  
```{r linear trend (estimate slope and IC95%) for the number of flowers from Order 0}
Gariguette<- fc_linear_trend_reg(data = dat_group,
                                 genotype = "Gariguette",
                                 variable = "nb_total_flowers",
                                 Index = "Index")

Clery<- fc_linear_trend_reg(data = dat_group,
                            genotype = "Gariguette",
                            variable = "nb_total_flowers",
                            Index = "Index")

Capriss<- fc_linear_trend_reg(data = dat_group,
                              genotype = "Capriss",
                              variable = "nb_total_flowers",
                              Index = "Index")

Ciflorette<- fc_linear_trend_reg(data = dat_group,
                                 genotype = "Ciflorette",
                                 variable = "nb_total_flowers",
                                 Index = "Index")

Cir107<- fc_linear_trend_reg(data = dat_group,
                             genotype = "Cir107",
                             variable = "nb_total_flowers",
                             Index = "Index")

Darselect<- fc_linear_trend_reg(data = dat_group,
                                genotype = "Darselect",
                                variable = "nb_total_flowers",
                                Index = "Index")

tab5<- merge(x = Gariguette,y = Clery,all=T)
tab5<- merge(x = tab5,y = Capriss, all=T)
tab5<- merge(x = tab5,y = Ciflorette, all=T)
tab5<- merge(x = tab5,y = Cir107, all=T)
tab5<- merge(x = tab5,y = Darselect, all=T)

kable(x = tab5,digits = 2,caption = "Linear trend (estimate slope and 95% confidence interval -IC95%-) for the number of flowers as function of module orders from zeroth-order onward (orders >=0)")
```

  - *From Order 1*
  
```{r linear trend (estimate slope and IC95%) for the number of flowers from Order 0}
Gariguette<- fc_linear_trend_reg(data = dat_group_from_Order1,
                                 genotype = "Gariguette",
                                 variable = "nb_total_flowers",
                                 Index = "Index")

Clery<- fc_linear_trend_reg(data = dat_group_from_Order1,
                            genotype = "Gariguette",
                            variable = "nb_total_flowers",
                            Index = "Index")

Capriss<- fc_linear_trend_reg(data = dat_group_from_Order1,
                              genotype = "Capriss",
                              variable = "nb_total_flowers",
                              Index = "Index")

Ciflorette<- fc_linear_trend_reg(data = dat_group_from_Order1,
                                 genotype = "Ciflorette",
                                 variable = "nb_total_flowers",
                                 Index = "Index")

Cir107<- fc_linear_trend_reg(data = dat_group_from_Order1,
                             genotype = "Cir107",
                             variable = "nb_total_flowers",
                             Index = "Index")

Darselect<- fc_linear_trend_reg(data = dat_group_from_Order1,
                                genotype = "Darselect",
                                variable = "nb_total_flowers",
                                Index = "Index")

tab5<- merge(x = Gariguette,y = Clery,all=T)
tab5<- merge(x = tab5,y = Capriss, all=T)
tab5<- merge(x = tab5,y = Ciflorette, all=T)
tab5<- merge(x = tab5,y = Cir107, all=T)
tab5<- merge(x = tab5,y = Darselect, all=T)

kable(x = tab5,digits = 2,caption = "Linear trend (estimate slope and 95% confidence interval -IC95%-) for the number of flowers as function of module orders from zeroth-order onward (orders >=0)")
```

* **From Order 2**

```{r linear trend (estimate slope and IC95%) from Order 2}
dat_group_from_Order2<-dat_group_from_Order1[!dat_group_from_Order1[,'Index']=="1",]

Gariguette<- fc_linear_trend_reg(data = dat_group_from_Order2,
                                 genotype = "Gariguette",
                                 variable = "nb_total_flowers",
                                 Index = "Index")

Clery<- fc_linear_trend_reg(data = dat_group_from_Order2,
                            genotype = "Gariguette",
                            variable = "nb_total_flowers",
                            Index = "Index")

Capriss<- fc_linear_trend_reg(data = dat_group_from_Order2,
                              genotype = "Capriss",
                              variable = "nb_total_flowers",
                              Index = "Index")

Ciflorette<- fc_linear_trend_reg(data = dat_group_from_Order2,
                                 genotype = "Ciflorette",
                                 variable = "nb_total_flowers",
                                 Index = "Index")

Cir107<- fc_linear_trend_reg(data = dat_group_from_Order2,
                             genotype = "Cir107",
                             variable = "nb_total_flowers",
                             Index = "Index")

Darselect<- fc_linear_trend_reg(data = dat_group_from_Order2,
                                genotype = "Darselect",
                                variable = "nb_total_flowers",
                                Index = "Index")

tab7<- merge(x = Gariguette,y = Clery,all=T)
tab7<- merge(x = tab7,y = Capriss, all=T)
tab7<- merge(x = tab7,y = Ciflorette, all=T)
tab7<- merge(x = tab7,y = Cir107, all=T)
tab7<- merge(x = tab7,y = Darselect, all=T)

kable(x = tab7,digits = 2,caption = "Linear trend (estimate slope and 95% confidence interval -IC95%-)")
```

**Result:** The no. leaves was roughly constant from second-order module

* ** Comparison between variety for zeroth-order module and first-order modules and second-order module onwards**

  - * For zeroth-order module*

```{r Comparison of Mean No.flowers for zeroth-order module between varieties}

tab10<-fc_comp_varieties_kruskal_posthoc(data = dat_group_Order0,varname = "nb_total_flowers",group = T)


kable(x = tab10,digits = 2,caption = "Mean number with standard deviation and grouping of varieties using ANOVA on rank (Kruskal Wallis and posthoc test) represented by letter for zeroth-order module")
```  
  - * For the first-order module*
  
```{r Comparison of Mean No.flowers for zeroth-order module between varieties}

dat_group_Order1<- dat_group[dat_group[,"Index"]==1,]

tab10<-fc_comp_varieties_kruskal_posthoc(data = dat_group_Order1,varname = "nb_total_flowers",group = T)


kable(x = tab10,digits = 2,caption = "Mean number with standard deviation and grouping of varieties using ANOVA on rank (Kruskal Wallis and posthoc test) represented by letter for first-order module")
```    
 
  - * For second-order module onwards*

```{r Comparison of Mean No.flowers from Order 2 onward between varieties}

tab10<-fc_comp_varieties_kruskal_posthoc(data = dat_group_from_Order2,varname = "nb_total_flowers",group = T)


kable(x = tab10,digits = 2,caption = "Mean number with standard deviation and grouping of varieties using ANOVA on rank (Kruskal Wallis and posthoc test) represented by letter from the second-order modules onward")
```

### stolons

```{r Table of relative frequency of no. stolons by module orders}
tab11<-fc_dist_variable_by_order(data = dat_group,genotype = "Gariguette",varname = "stolons",prob = T)

kable(x = tab11, 
      caption = "Relative distribution of no. stolon by orders",digits = 2)

```

```{r Plot of relative frequency of no. stolons by module orders, fig.cap= "Relative frequency distribution of the number of stolons  for successive orders for XX"}
fc_dist_variable_by_order.plot(data = tab11)+
  xlab("No. stolon")+
  ylab("relative distribution function")
```

```{r Pointwise mean of no. stolon for successive module oders and for each varieties, fig.cap="Pointwise mean of no. stolon for successive module oders and for each varieties"}

fc_pointwise_mean_variable_by_order(data = dat_group, varname = "stolons")

```



### Comparison of categorical variables

#### Branch crown

Because the zeroth-order module is primary crown, to compare ramification for each module order we compare only from first-order module

* **Relative frequency or proportion of branch crown**

```{r Relative frequency data}
dat_ramif<- dat_group[!dat_group[,"type_of_crown"]=="Primary_Crown",]

Capriss<-fc_dist_cat_variable_by_order(data = dat_ramif,genotype = "Capriss",varname = "type_of_crown",prob = T)
Ciflorette<-fc_dist_cat_variable_by_order(data = dat_ramif,genotype = "Ciflorette",varname = "type_of_crown",prob = T)
Cir107<-fc_dist_cat_variable_by_order(data = dat_ramif,genotype = "Cir107",varname = "type_of_crown",prob = T)
Clery<-fc_dist_cat_variable_by_order(data = dat_ramif,genotype = "Clery",varname = "type_of_crown",prob = T)
Darselect<-fc_dist_cat_variable_by_order(data = dat_ramif,genotype = "Darselect",varname = "type_of_crown",prob = T)
Gariguette<-fc_dist_cat_variable_by_order(data = dat_ramif,genotype = "Gariguette",varname = "type_of_crown",prob = T)

tab12<-merge(x = Capriss,y = Ciflorette, all=T)
tab12<-merge(x = tab12,y = Cir107, all=T)
tab12<-merge(x = tab12,y = Clery, all=T)
tab12<-merge(x = tab12,y = Darselect, all=T)
tab12<-merge(x = tab12,y = Gariguette, all=T)

tab12<- tab12[order(tab12$genotype),]

kable(x = tab12,digits = 2,caption = "Relative frequency distribution or branch crown and extention crownas function of module orders for each variety")
```


```{r Relative frequencies of branch or Extention crown as a function of module orders for each varieties, fig.cap="Relative frequencies of branch crown as a function of module orders for each varieties"}
fc_dist_cat_variable_by_order.plot(data = tab12,varname = "Branch_Crown")  
```

```{r Relative frequencies of branch crown as a function of module orders for each varieties, fig.cap="Relative frequencies of extension crown as a function of module orders for each varieties"}
fc_dist_cat_variable_by_order.plot(data = tab12,varname = "Extention_Crown")  
```

* **Identification from wich module variable was roughly constant for each varieties (chi2-test)**

  - *Comparison from zeroth-order module (from >= 1)*
  
```{r Chi2 Comparaison of proportion of branch/extension crown for successive module order from first-order module}
Capriss<- fc_chi_by_order(data = dat_group,
                          genotype = "Capriss",
                          varname = "type_of_crown",
                          var.comp = c("Branch_Crown",
                                       "Extention_Crown"),
                          idx.comp = c("1","2","3"),
                          parameter = ">=1",
                          table = F)

Ciflorette<- fc_chi_by_order(data = dat_group,
                             genotype = "Ciflorette",
                             varname = "type_of_crown",
                             var.comp = c("Branch_Crown",
                                          "Extention_Crown"),
                             idx.comp = c("1","2","3","4"),
                             parameter = ">=1",
                             table = F)

Cir107<- fc_chi_by_order(data = dat_group,
                         genotype = "Cir107",
                         varname = "type_of_crown",
                         var.comp = c("Branch_Crown",
                                      "Extention_Crown"),
                         idx.comp = c("1","2","3","4"),
                         parameter = ">=1",
                         table = F)

Clery<- fc_chi_by_order(data = dat_group,
                        genotype = "Clery",
                        varname = "type_of_crown",
                        var.comp = c("Branch_Crown",
                                     "Extention_Crown"),
                        idx.comp = c("1","2","3","4"),
                        parameter = ">=1",
                        table = F)

Darselect<- fc_chi_by_order(data = dat_group,
                            genotype = "Darselect",
                            varname = "type_of_crown",
                            var.comp = c("Branch_Crown",
                                         "Extention_Crown"),
                            idx.comp = c("1","2","3","4"),
                            parameter = ">=1",
                            table = F)

Gariguette<- fc_chi_by_order(data = dat_group,
                             genotype = "Gariguette",
                             varname = "type_of_crown",
                             var.comp = c("Branch_Crown",
                                          "Extention_Crown"),
                             idx.comp = c("1","2","3","4"),
                             parameter = ">=1",
                             table = F)


tab13<-merge(x = Capriss,y = Ciflorette, all=T)
tab13<-merge(x = tab13,y = Cir107, all=T)
tab13<-merge(x = tab13,y = Clery, all=T)
tab13<-merge(x = tab13,y = Darselect, all=T)
tab13<-merge(x = tab13,y = Gariguette, all=T)

tab13<- tab13[order(tab13$genotype),]

kable(x = tab13,digits = 2, caption = "Chi2 Comparaison of proportion of branch/extension crown for successive module order from first-order module")
```

  - *Comparison from zeroth-order module (from >= 2)*

```{r Chi2 Comparaison of proportion of branch/extension crown for successive module order from second-order module}

Capriss<- fc_chi_by_order(data = dat_group,
                          genotype = "Capriss",
                          varname = "type_of_crown",
                          var.comp = c("Branch_Crown",
                                       "Extention_Crown"),
                          idx.comp = c("2","3"),
                          parameter = ">=2",
                          table = F)

Ciflorette<- fc_chi_by_order(data = dat_group,
                             genotype = "Ciflorette",
                             varname = "type_of_crown",
                             var.comp = c("Branch_Crown",
                                          "Extention_Crown"),
                             idx.comp = c("2","3","4"),
                             parameter = ">=2",
                             table = F)

Cir107<- fc_chi_by_order(data = dat_group,
                         genotype = "Cir107",
                         varname = "type_of_crown",
                         var.comp = c("Branch_Crown",
                                      "Extention_Crown"),
                         idx.comp = c("2","3","4"),
                         parameter = ">=2",
                         table = F)

Clery<- fc_chi_by_order(data = dat_group,
                        genotype = "Clery",
                        varname = "type_of_crown",
                        var.comp = c("Branch_Crown",
                                     "Extention_Crown"),
                        idx.comp = c("2","3","4"),
                        parameter = ">=2",
                        table = F)

Darselect<- fc_chi_by_order(data = dat_group,
                            genotype = "Darselect",
                            varname = "type_of_crown",
                            var.comp = c("Branch_Crown",
                                         "Extention_Crown"),
                            idx.comp = c("2","3","4"),
                            parameter = ">=2",
                            table = F)

Gariguette<- fc_chi_by_order(data = dat_group,
                             genotype = "Gariguette",
                             varname = "type_of_crown",
                             var.comp = c("Branch_Crown",
                                          "Extention_Crown"),
                             idx.comp = c("2","3","4"),
                             parameter = ">=2",
                             table = F)


tab14<-merge(x = Capriss,y = Ciflorette, all=T)
tab14<-merge(x = tab14,y = Cir107, all=T)
tab14<-merge(x = tab14,y = Clery, all=T)
tab14<-merge(x = tab14,y = Darselect, all=T)
tab14<-merge(x = tab14,y = Gariguette, all=T)

tab14<- tab14[order(tab14$genotype),]

kable(x = tab14,digits = 2, caption = "Chi2 Comparaison of proportion of branch/extension crown for successive module order from first-order module")
```

* ** Comparison between varieties for zeroth-order modules and from first-order module onward**

  - *Comparison between varieties for first-order module*


```{r Comparison between varieties for zeroth-order module}
dat_group_Order1<- dat_group[dat_group[,"Index"]=="1",]

tab15<-fc_comp_varieties_chi2.fisher(data = dat_group_Order1,varname = "type_of_crown",comp = "genotype")

kable(x = tab15,digits = 2,caption = "Fisher comparison of proportion of branch crown extension crown for the first-order module (Order1)")
```

  - *Comparison between varieties from second-order module onwards*
```{r Comparison between varieties from second-order module onwards}

tab15<-fc_comp_varieties_chi2.fisher(data = dat_group_from_Order2,varname = "type_of_crown",comp = "genotype")

kable(x = tab15,digits = 2,caption = "Fisher comparison of proportion of branch crown extension crown from second-order module onwards (Order>=2)")
```
